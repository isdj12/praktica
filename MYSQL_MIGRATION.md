# Миграция на MySQL

Этот документ содержит инструкции по переносу вашего приложения с SQLite на MySQL.

## Предварительные требования

У вас есть два варианта настройки MySQL:

### Вариант 1: Использование Docker (рекомендуется)

1. Установленный Docker и Docker Compose ([скачать Docker](https://www.docker.com/products/docker-desktop/))
2. Не требуется устанавливать MySQL отдельно

### Вариант 2: Локальная установка MySQL

1. Установленный MySQL сервер (можно скачать с [официального сайта](https://dev.mysql.com/downloads/))
2. Настроенная учетная запись MySQL с правами на создание баз данных

## Шаги по миграции

### Вариант 1: Быстрая миграция (рекомендуется)

Просто выполните команду:

```bash
npm run use-mysql
```

Эта команда автоматически:
1. Проверит наличие Docker и запустит MySQL контейнер
2. Выполнит миграцию данных из SQLite в MySQL
3. Обновит конфигурацию в файле .env
4. Предоставит инструкции для запуска приложения

### Вариант 2: Ручная миграция

#### 1. Настройте MySQL

##### Если вы используете Docker:

1. Запустите MySQL контейнер:
   ```bash
   docker-compose up -d
   ```

2. Проверьте, что контейнер запущен:
   ```bash
   docker ps
   ```

##### Если вы используете локальную установку MySQL:

1. Создайте базу данных и пользователя:
   ```sql
   CREATE DATABASE game_catalog;
   CREATE USER 'gameuser'@'localhost' IDENTIFIED BY 'gamepassword';
   GRANT ALL PRIVILEGES ON game_catalog.* TO 'gameuser'@'localhost';
   FLUSH PRIVILEGES;
   ```

#### 2. Обновите переменные окружения

Файл `.env` уже содержит необходимые параметры для подключения к MySQL:

```
DB_TYPE=mysql
MYSQL_HOST=localhost
MYSQL_PORT=3306
MYSQL_USER=gameuser
MYSQL_PASSWORD=gamepassword
MYSQL_DATABASE=game_catalog
```

Если вы используете свои настройки MySQL, измените эти параметры соответствующим образом.

#### 3. Запустите скрипт миграции

Скрипт миграции перенесет все данные из SQLite в MySQL:

```bash
npm run migrate-to-mysql
```

Этот скрипт выполнит следующие действия:
- Создаст базу данных MySQL, если она не существует
- Создаст все необходимые таблицы в MySQL
- Перенесет все данные из SQLite в MySQL (пользователи, игры, теги, скриншоты и т.д.)

#### 4. Проверьте миграцию

После завершения миграции приложение автоматически начнет использовать MySQL вместо SQLite.

Чтобы проверить, что миграция прошла успешно:

1. Запустите приложение:
   ```bash
   npm start
   ```

2. Проверьте, что все функции работают как ожидается:
   - Авторизация пользователей
   - Просмотр каталога игр
   - Добавление/удаление игр

## Возврат к SQLite

Если вам нужно вернуться к использованию SQLite, просто выполните команду:

```bash
npm run use-sqlite
```

## Возможные проблемы

### Ошибка подключения к MySQL

Если вы видите ошибку подключения к MySQL, проверьте:
- Правильно ли указаны учетные данные в файле `.env`
- Запущен ли сервер MySQL или Docker контейнер
- Доступен ли MySQL с вашего хоста (порт 3306 по умолчанию)

### Ошибки миграции данных

Если некоторые данные не перенеслись:
1. Проверьте консольные ошибки во время миграции
2. Исправьте проблемы, указанные в сообщениях об ошибках
3. Очистите базу данных MySQL и запустите миграцию заново:
   ```sql
   DROP DATABASE game_catalog;
   CREATE DATABASE game_catalog;
   ```
   ```bash
   npm run migrate-to-mysql
   ```

## Преимущества MySQL

- Лучшая производительность при большом количестве пользователей
- Возможность масштабирования
- Более надежная поддержка транзакций
- Лучшая поддержка для сложных запросов
- Возможность настройки производительности

## Удаление Docker контейнера (если использовался Docker)

Если вы хотите удалить Docker контейнер после миграции:

```bash
docker-compose down
```

Если вы хотите удалить и данные:

```bash
docker-compose down -v
``` 
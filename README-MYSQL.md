# Миграция на MySQL

## Что было сделано

Приложение было обновлено для поддержки MySQL в качестве основной базы данных. Вот список изменений:

1. **Поддержка двух типов баз данных**: Теперь приложение может работать как с SQLite, так и с MySQL
2. **Скрипт миграции данных**: Создан скрипт для переноса всех данных из SQLite в MySQL
3. **Docker интеграция**: Добавлен Docker Compose для быстрой настройки MySQL
4. **Обновленный модуль базы данных**: Модуль `db.js` теперь поддерживает оба типа баз данных
5. **Конфигурация через переменные окружения**: Добавлены настройки для MySQL в файл `.env`
6. **Автоматический откат на SQLite**: Если MySQL недоступен, приложение автоматически использует SQLite
7. **Скрипт для переключения между базами**: Добавлены команды для быстрого переключения между базами данных

## Файлы, которые были изменены или добавлены

- `src/database/db.js`: Модуль базы данных с поддержкой MySQL
- `migrate-to-mysql.js`: Скрипт для миграции данных
- `switch-database.js`: Скрипт для переключения между базами данных
- `docker-compose.yml`: Конфигурация Docker для MySQL
- `.env`: Добавлены параметры подключения к MySQL
- `package.json`: Добавлены команды для запуска миграции и переключения баз данных
- `MYSQL_MIGRATION.md`: Подробные инструкции по миграции

## Как использовать

Подробные инструкции по миграции на MySQL доступны в файле [MYSQL_MIGRATION.md](MYSQL_MIGRATION.md).

### Краткое руководство:

#### Простой способ переключения (рекомендуется):

Для переключения между базами данных используйте следующие команды:

```bash
# Переключиться на MySQL
npm run use-mysql

# Переключиться на SQLite
npm run use-sqlite
```

Эти команды автоматически:
- Проверят наличие Docker и запустят MySQL контейнер (для MySQL)
- Запустят миграцию данных (при переключении на MySQL)
- Обновят конфигурацию в файле .env
- Предоставят инструкции для запуска приложения

#### Ручная настройка:

1. Установите MySQL
   
   **С помощью Docker** (рекомендуется):
   ```bash
   docker-compose up -d
   ```
   
   **Или локальную установку** MySQL:
   - Установите MySQL сервер с официального сайта
   - Создайте базу данных и пользователя (см. инструкции в MYSQL_MIGRATION.md)

2. Запустите скрипт миграции:
   ```bash
   npm run migrate-to-mysql
   ```

3. Измените настройку базы данных в `.env`:
   ```
   DB_TYPE=mysql
   ```

4. Запустите приложение:
   ```bash
   npm start
   ```

## Устранение неполадок

### Приложение не запускается после миграции

Если после изменения `DB_TYPE=mysql` приложение не запускается:

1. Проверьте, что MySQL сервер запущен и доступен
2. Убедитесь, что параметры подключения в `.env` правильные
3. Попробуйте вернуться к SQLite:
   ```bash
   npm run use-sqlite
   ```

### Ошибка подключения к MySQL

Если вы видите ошибку "Не удалось подключиться к MySQL":

1. **При использовании Docker**:
   - Убедитесь, что Docker запущен
   - Проверьте, что контейнер MySQL запущен: `docker ps`
   - Перезапустите контейнер: `docker-compose restart`

2. **При локальной установке MySQL**:
   - Убедитесь, что MySQL сервер запущен
   - Проверьте, что порт 3306 не заблокирован брандмауэром
   - Проверьте правильность имени пользователя и пароля в `.env`

### Ошибка в данных после миграции

Если после миграции данные отображаются некорректно:

1. Сравните данные в SQLite и MySQL
2. При необходимости очистите базу данных MySQL и повторите миграцию:
   ```sql
   DROP DATABASE game_catalog;
   CREATE DATABASE game_catalog;
   ```
   ```bash
   npm run migrate-to-mysql
   ```

## Особенности использования

### Автоматический переход на SQLite

Приложение автоматически переключится на SQLite, если MySQL недоступен. Это позволяет:
- Обеспечить бесперебойную работу при проблемах с MySQL
- Упростить локальную разработку без необходимости настройки MySQL
- Постепенно мигрировать на MySQL без риска простоя

### Переключение между базами данных

Вы можете в любой момент переключаться между SQLite и MySQL с помощью команд:
```bash
npm run use-mysql   # Для использования MySQL
npm run use-sqlite  # Для использования SQLite
```

## Преимущества использования MySQL

- **Производительность**: MySQL обеспечивает лучшую производительность при высоких нагрузках
- **Масштабируемость**: Возможность горизонтального и вертикального масштабирования
- **Надежность**: Поддержка транзакций, резервного копирования и репликации
- **Поддержка сложных запросов**: Расширенные возможности SQL, включая JOIN, подзапросы и т.д.
- **Безопасность**: Расширенные возможности управления доступом

## Дополнительные ресурсы

- [Документация MySQL](https://dev.mysql.com/doc/)
- [Руководство по Node.js и MySQL](https://www.w3schools.com/nodejs/nodejs_mysql.asp)
- [Docker Hub: MySQL](https://hub.docker.com/_/mysql) 